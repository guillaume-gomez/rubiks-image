import{r as c,i as ee,j as Ne,k as le,l as Re,n as e,o as Me,p as ge,q as Se,t as pe,v as ke,w as K,x as Ie,y as De}from"./vendor-DWJ8hSXJ.js";import{R as Be,B as Ee,M as q,V as U,O as oe,a as $,E as ne,C as Fe,b as Ae,c as ze,G as Pe,d as Le,e as Te}from"./three-5E7CEbIn.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const x of s)if(x.type==="childList")for(const p of x.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&n(p)}).observe(document,{childList:!0,subtree:!0});function r(s){const x={};return s.integrity&&(x.integrity=s.integrity),s.referrerPolicy&&(x.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?x.credentials="include":s.crossOrigin==="anonymous"?x.credentials="omit":x.credentials="same-origin",x}function n(s){if(s.ep)return;s.ep=!0;const x=r(s);fetch(s.href,x)}})();function Oe(o,t){if(o=Math.abs(o),t=Math.abs(t),t>o){let r=o;o=t,t=r}for(;;){if(t===0)return o;if(o%=t,o===0)return t;t%=o}}function ue(o){const t=o.getContext("2d");if(!t)throw new Error("cannot find the context 2d for the canvas");return t}function te(o){const t=o.getContext("2d");if(!t)throw new Error("cannot find the context 2d for the canvas");return t}function We(o,t){const r=t.red-o.red,n=t.green-o.green,s=t.blue-o.blue;return r*r+n*n+s*s}function be(o,t,r,n){const s=new OffscreenCanvas(o.width*.5,o.height*.5),x=ue(s);x.drawImage(o,0,0,s.width,s.height),x.drawImage(s,0,0,s.width*.5,s.height*.5);const p=ue(t);t.width=r,t.height=n,p.drawImage(s,0,0,s.width*.5,s.height*.5,0,0,r,n)}const de=5e3;function He({initialTileSize:o=32}){const[t,r]=c.useState(0),[n,s]=c.useState(0),[x,p]=c.useState(!0),[y,j]=c.useState(o),[l,u]=c.useState(1),[d,C]=c.useState(3);function g(i,a){r(i),s(a)}function f(i){return Math.round(i/(3*y))*(3*y)}function E(i,a,I,D){const S=Oe(i,a),B=i/S,P=a/S,L=B*I,O=P*I;if(D){const T=Math.ceil(i/L),W=L*T,G=O*T;return[W,G]}else return[L*l,O*l]}function h(i,a){const I=f(i),D=f(a);return E(I,D,y,x)}function v(i,a,I){const[D,S]=h(i,a);if(g(D,S),x)u(1);else{const B=R(D/l,S/l,I);C(B),B===3&&u(3)}return[D,S]}function R(i,a,I){const D=I?de/2:de,S=Math.ceil(Math.sqrt(D*y*y/(i*a)));return S<=3?3:S-S%3}return{computePossibleSize:v,setPossibleSize:g,possibleWidth:t,possibleHeight:n,ratio:l,setRatio:u,maxRatio:d,bestProportion:x,setBestProportion:p,tileSize:y,setTileSize:j}}const Ue=32,he=[{name:"white",color:{red:255,green:255,blue:255},hexColor:"#FFFFFF"},{name:"green",color:{red:124,green:178,blue:87},hexColor:"#7CCF57"},{name:"yellow",color:{red:238,green:207,blue:78},hexColor:"#EECF4E"},{name:"orange",color:{red:236,green:112,blue:45},hexColor:"#EC702D"},{name:"red",color:{red:189,green:40,blue:39},hexColor:"#BD2827"},{name:"blue",color:{red:44,green:93,blue:166},hexColor:"#2C5DA6"}];function Ge({initialTileSize:o=Ue}){const[t,r]=c.useState(0),[n,s]=c.useState(o),[x,p]=c.useState([]);function y(g){const f=new OffscreenCanvas(g.width,g.height);return te(f).drawImage(g,0,0,f.width,f.height),f}function j(g,f,E){const h=y(g),v=te(h);be(h,h,f,E);let R=[];for(let i=0;i<h.height;i+=3*n)for(let a=0;a<h.width;a+=3*n){const I=d(l(v,n,a,i)),D=d(l(v,n,a+n,i)),S=d(l(v,n,a+2*n,i)),B=d(l(v,n,a,i+n)),P=d(l(v,n,a+n,i+n)),L=d(l(v,n,a+2*n,i+n)),O=d(l(v,n,a,i+2*n)),T=d(l(v,n,a+n,i+2*n)),W=d(l(v,n,a+2*n,i+2*n)),G=[{color:I,x:a,y:i},{color:D,x:a+n,y:i},{color:S,x:a+2*n,y:i},{color:B,x:a,y:i+n},{color:P,x:a+n,y:i+n},{color:L,x:a+2*n,y:i+n},{color:O,x:a,y:i+2*n},{color:T,x:a+n,y:i+2*n},{color:W,x:a+2*n,y:i+2*n}];R.push(G)}p(R)}function l(g,f,E,h){const v=g.getImageData(E,h,f,f),{data:R}=v,i=f*f;let a=0,I=0,D=0;for(let S=0;S<R.length;S+=4)a+=R[S],I+=R[S+1],D+=R[S+2];return{red:a/i,green:I/i,blue:D/i}}function u(g){const f=he.map(h=>({...h,value:We(g,h.color)})),E=Ne(f,"value");if(!E)throw`No sprite found for the pixel with the value ${g}`;return E.hexColor}function d(g){if(Math.random()<t/100){const f=ee(he);return u(f.color)}return u(g)}function C(g,f){switch(g){case"noise":{r(f);break}case"tileSize":{s(f);break}default:return}}return{optimizedGenerateImage:j,setOption:C,noise:t,tileSize:n,rubickFaces:x}}function $e(){const[o,t]=c.useState();function r(j,l,u){return(l*u+j)*4}function n(j,l,u){let d=Re(Array(101),0);const C=[],{data:g}=j.getImageData(0,0,l,u);for(let a=0;a<l;a++)for(let I=0;I<u;I++){const D=r(a,I,l),S=g[D],B=g[D+1],P=g[D+2],[L,O,T]=le.rgb.hsv(S,B,P);C.push([L,O,T]);const W=T;d.includes(W)?d[W]+=1:d[W]=1}const f=[...d].sort();let E=0;const h=f.map(a=>(E+=a,E)),v=h[0],R=h[h.length-1];return[h.map(a=>(a-v)*100/(R-v)),C]}function s(j){const l=new OffscreenCanvas(j.width,j.height);return te(l).drawImage(j,0,0,l.width,l.height),l}function x(j,l){const{width:u,height:d}=j,C=s(j),g=te(C),[f,E]=n(g,u,d),h=g.getImageData(0,0,u,d);for(let R=0;R<u;R++)for(let i=0;i<d;i++){const a=r(R,i,u),[I,D,S]=E[R*d+i],B=f[S],[P,L,O]=le.hsv.rgb([I,D,Math.floor(S+B)]);h.data[a]=P,h.data[a+1]=L,h.data[a+2]=O,h.data[a+3]=h.data[a+3]}l.width=u,l.height=d;const v=l.getContext("2d");if(!v)throw new Error("Cannot find context 2d");return v.putImageData(h,0,0),l.toDataURL()}function p(j){return new Promise((l,u)=>{const d=new Image;d.src=j,d.onload=()=>{l(d)},d.onerror=C=>{u(C)}})}async function y(j,l){const u=x(j,l),d=await p(u);t(d)}return{contrastedImage:o,computeImage:y}}const ae="/rubiks-image/logo.svg";function Ve(){return e.jsxs("div",{className:"navbar bg-primary text-primary-content items-center justify-between",children:[e.jsxs("div",{className:"flex flex-row gap-1 items-center",children:[e.jsx("img",{src:ae,alt:"logo of Rubick image",width:"56px"}),e.jsx("a",{className:"btn btn-ghost btn-accent normal-case text-xl",children:"Rubick's Image"})]}),e.jsx("div",{children:e.jsx("a",{href:"https://github.com/guillaume-gomez/rubiks-image",target:"_blank",rel:"noopener noreferrer",className:"btn btn-secondary",children:e.jsxs("svg",{width:"18",height:"18",className:"h-5 w-5",viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M29.3444 30.4765C31.7481 29.977 33.9292 29.1108 35.6247 27.8391C38.5202 25.6676 40 22.3136 40 18.9999C40 16.6752 39.1187 14.505 37.5929 12.6668C36.7427 11.6425 39.2295 3.99989 37.02 5.02919C34.8105 6.05848 31.5708 8.33679 29.8726 7.83398C28.0545 7.29565 26.0733 6.99989 24 6.99989C22.1992 6.99989 20.4679 7.22301 18.8526 7.6344C16.5046 8.23237 14.2591 5.99989 12 5.02919C9.74086 4.05848 10.9736 11.9632 10.3026 12.7944C8.84119 14.6051 8 16.7288 8 18.9999C8 22.3136 9.79086 25.6676 12.6863 27.8391C14.6151 29.2857 17.034 30.2076 19.7401 30.6619",stroke:"currentColor",strokeWidth:"4",strokeLinecap:"butt"}),e.jsx("path",{d:"M19.7397 30.6619C18.5812 31.937 18.002 33.1478 18.002 34.2944C18.002 35.441 18.002 38.3464 18.002 43.0106",stroke:"currentColor",strokeWidth:"4",strokeLinecap:"butt"}),e.jsx("path",{d:"M29.3446 30.4766C30.4423 31.9174 30.9912 33.211 30.9912 34.3576C30.9912 35.5042 30.9912 38.3885 30.9912 43.0107",stroke:"currentColor",strokeWidth:"4",strokeLinecap:"butt"}),e.jsx("path",{d:"M6 31.2155C6.89887 31.3254 7.56554 31.7387 8 32.4554C8.65169 33.5303 11.0742 37.518 13.8251 37.518C15.6591 37.518 17.0515 37.518 18.0024 37.518",stroke:"currentColor",strokeWidth:"4",strokeLinecap:"butt"})]})})})]})}const qe="/rubiks-image/star.svg";function Xe(){return e.jsxs("footer",{className:"footer sm:footer-horizontal bg-neutral text-neutral-content items-center p-4",children:[e.jsx("aside",{className:"items-center grid-flow-col",children:e.jsx("p",{children:"Made by Guillaume Gomez - (2024 - 2025)"})}),e.jsx("nav",{className:"grid-flow-col gap-4 md:place-self-center md:justify-self-end",children:e.jsxs("p",{className:"flex items-center",children:["Did you enjoyed ? ðŸ˜Š Give a",e.jsx("a",{href:"https://github.com/guillaume-gomez/rubiks-image",className:"btn btn-sm btn-ghost px-1",children:e.jsx("img",{src:qe,alt:"a star",width:"24px"})}),"to this project"]})})]})}function ie({title:o,children:t,bgColor:r="bg-base-200",titleClass:n="card-title"}){return e.jsx("div",{className:`card ${r} shadow-xl h-full`,children:e.jsxs("div",{className:"card-body p-4",children:[e.jsx("h2",{className:n,children:o}),t]})})}function fe({title:o,children:t}){return e.jsx(ie,{title:o,bgColor:"bg-base-300",titleClass:"card-title",children:t})}function me({title:o,children:t}){return e.jsx(ie,{title:o,bgColor:"bg-base-200",titleClass:"text-lg bold",children:t})}function _e({children:o}){var s;const[t,r]=c.useState(!0),n=c.useRef(null);return e.jsx(ie,{title:e.jsxs("div",{className:"flex flex-row items-center justify-between",children:[e.jsx("span",{children:"Advanced Settings"}),e.jsx("button",{className:"btn btn-sm btn-ghost text-xl",onClick:()=>r(!t),children:e.jsxs("div",{className:`anim-container ${t?"morphed":""}`,children:[e.jsxs("svg",{className:"icons plus",viewBox:"0 0 1024 1024",fill:"currentColor",height:"1em",width:"1em",children:[e.jsx("path",{d:"M696 480H544V328c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v152H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h152v152c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V544h152c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}),e.jsx("path",{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"})]}),e.jsxs("svg",{className:"icons minus",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,viewBox:"0 0 24 24",height:"1em",width:"1em",children:[e.jsx("path",{d:"M22 12 A10 10 0 0 1 12 22 A10 10 0 0 1 2 12 A10 10 0 0 1 22 12 z"}),e.jsx("path",{d:"M8 12h8"})]})]})})]}),bgColor:"bg-base-200",titleClass:"text-lg bold",children:e.jsx("div",{className:"overflow-y-hidden transition-all duration-300",style:{height:t?0:((s=n.current)==null?void 0:s.offsetHeight)||0},children:e.jsx("div",{ref:n,className:"flex flex-col gap-2",children:o})})})}function Ye({onChange:o,value:t}){function r(n){if(n&&n.target&&n.target.files){const s=new Image;s.src=URL.createObjectURL(n.target.files[0]),s.onload=()=>{o(s)}}}return e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("label",{className:"w-full flex flex-col justify-center items-center bg-white/40 text-primary shadow-lg uppercase border-2 border-primary transition duration-300 ease-in-out cursor-pointer hover:bg-primary hover:text-white",children:[e.jsx("svg",{className:"w-8 h-8",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M16.88 9.1A4 4 0 0 1 16 17H5a5 5 0 0 1-1-9.9V7a3 3 0 0 1 4.52-2.59A4.98 4.98 0 0 1 17 8c0 .38-.04.74-.12 1.1zM11 11h3l-4-4-4 4h3v3h2v-3z"})}),e.jsx("span",{className:"mt-2 leading-normal",children:"Select a picture"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:r})]}),t?e.jsx("img",{src:t.src,style:{minWidth:"64px",maxWidth:"100px"}}):e.jsx("span",{children:"Nothing to render"})]})}function Y({label:o,value:t,toggle:r}){return e.jsx("div",{className:"py-2",children:e.jsxs("label",{className:"label cursor-pointer gap-2 px-0 flex flex-row justify-between align-center",children:[e.jsx("span",{className:"label-text font-semibold",children:o}),e.jsx("input",{type:"checkbox",className:"toggle toggle-primary",checked:t,onChange:r})]})})}function re({label:o,value:t,onChange:r,min:n=0,max:s=100,step:x=1,disabled:p=!1}){return n===s||p?e.jsxs("label",{className:"label cursor-pointer flex flex-row gap-2",children:[e.jsx("span",{className:"label-text font-semibold h-full",children:o}),e.jsx("span",{className:"font-bold",children:t})]}):e.jsx("div",{className:"form-control",children:e.jsxs("label",{className:"label cursor-pointer flex flex-row gap-2",children:[e.jsx("span",{className:"label-text font-semibold h-full",children:o}),e.jsxs("div",{className:"w-full flex flex-col gap-0",children:[e.jsx("input",{type:"range",min:n,max:s,step:x,value:t,className:"range range-primary range-sm",onChange:y=>r(parseInt(y.target.value,10))}),e.jsxs("div",{className:"flex flex-row justify-between text-sm",children:[e.jsx("span",{className:"italic",children:n}),e.jsx("span",{className:"font-bold",children:t}),e.jsx("span",{className:"italic",children:s})]})]})]})})}function Ze({errorMessage:o}){return e.jsxs("div",{className:"alert alert-error",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"stroke-current shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{children:o})]})}function Je({label:o,filename:t,canvasRef:r,disabled:n=!1}){const s=c.useRef(null);function x(){if(r.current&&s.current){const p="jpeg",y=r.current.toDataURL(`image/${p}`),j=Me(new Date,"dd-MM-yyyy-hh-mm");s.current.download=`${t}-${j}.${p}`,s.current.href=y.replace(/^data:image\/[^;]/,"data:application/octet-stream")}}return e.jsxs("div",{className:"flex gap-1","data-tip":"Allow multiple download if you want to save more than one image",children:[e.jsx("a",{ref:s,className:`btn btn-primary ${n?"btn-disabled":""}`,onClick:()=>x(),children:o}),e.jsxs("div",{className:"dropdown dropdown-end",children:[e.jsx("div",{tabIndex:0,role:"button",className:"text-info",children:e.jsx("svg",{tabIndex:0,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",className:"w-4 h-4 stroke-current",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("div",{tabIndex:0,className:"card compact dropdown-content z-1 shadow bg-base-100 rounded-box w-64",children:e.jsxs("div",{tabIndex:0,className:"card-body",children:[e.jsx("h2",{className:"card-title",children:"Download did not start ? "}),e.jsxs("p",{children:["Allow",e.jsx("a",{className:"link px-1",href:"https://www.howtogeek.com/428416/how-to-enabledisable-multiple-file-downloads-in-chrome/",children:"multiple downloads"}),"on your browser if you want to save more than one image."]})]})})]})]})}const Ke=c.forwardRef(({width:o,height:t,tileSize:r,rubickFaces:n},s)=>{const[x,p]=c.useState(!0),[y,j]=c.useState(!1),l=c.useRef(null),u=c.useRef(null),{toggleFullscreen:d}=ge({target:l});c.useEffect(()=>{u.current&&(u.current.style.width="100%",u.current.style.height="100%",u.current.width=u.current.offsetWidth,u.current.height=u.current.offsetHeight)},[u]),c.useEffect(()=>{if(l.current&&l.current.width>0&&l.current.height>0&&u.current){const h=l.current.getContext("2d");if(!h)return;g(h,n),y&&C(h,o,t),be(l.current,u.current,l.current.width,l.current.height)}},[l,u,n,y]),c.useImperativeHandle(s,()=>({getImage(){return l.current?l.current.toDataURL("image/png"):null}}));function C(h,v,R){h.fillStyle="black",h.lineWidth=2;for(let i=0;i<v;i+=r)for(let a=0;a<R;a+=r)h.strokeRect(i,a,r,r);h.lineWidth=4;for(let i=0;i<v;i+=3*r)for(let a=0;a<R;a+=3*r)h.strokeRect(i,a,r*3,r*3)}function g(h,v){v.forEach(R=>f(h,R))}function f(h,v){v.forEach(({x:R,y:i,color:a})=>E(h,a,R,i))}function E(h,v,R,i){h.fillStyle=v,h.fillRect(R,i,r,r)}return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(Y,{label:"has border",value:y,toggle:()=>j(!y)}),e.jsx(Y,{label:"Show real result",value:x,toggle:()=>p(!x)}),e.jsx("span",{children:"The image could be wider than your screen. That is why we display the preview at first"}),e.jsx("canvas",{className:x?"w-full":"hidden",ref:u}),e.jsx("div",{className:`w-full relative overflow-x-scroll ${x?"absolute hidden":"absolute"}`,style:{minHeight:"400px"},children:e.jsx("canvas",{className:x?"absolute hidden":"absolute",ref:l,width:o,height:t,style:{background:"#797979",overflow:"scroll"},onDoubleClick:d})}),e.jsx("div",{className:"self-end",children:e.jsx(Je,{canvasRef:l,filename:"rubick-image",label:"Save as image"})})]})});function Qe({label:o,value:t,onChange:r,options:n}){return e.jsxs("select",{onChange:s=>r(s.target.value),value:t,className:"select select-bordered select-sm",children:[e.jsx("option",{className:"bg-neutral",disabled:!0,children:o}),n.map(({value:s,label:x})=>e.jsx("option",{value:s,children:x},s))]})}const et=.1,_=1-et,tt=new Be(_,_,_),nt=new Ee(_,_,_),X={roughness:0,metalness:.2,emissive:0,castShadow:!0},we=[new q({color:"#BD2827",...X}),new q({color:"#EC702D",...X}),new q({color:"#EECF4E",...X}),new q({color:"#FFFFFF",...X}),new q({color:"#2C5DA6",...X}),new q({color:"#7CCF57",...X})];function je(o){switch(o){case"#BD2827":return[0,-Math.PI/2,0];case"#EC702D":return[0,Math.PI/2,0];case"#EECF4E":return[Math.PI/2,0,0];case"#FFFFFF":return[-Math.PI/2,0,0];case"#2C5DA6":default:return[0,0,0];case"#7CCF57":return[0,Math.PI,0]}}function rt(o,t){switch(t.type){case"start":return{...o,started:!0};case"finish":return{...o,started:!1}}return o}const ve=c.createContext({duration:1e4,started:!1}),ye=c.createContext(()=>null);function Ce(){return c.useContext(ve)}function st(){return c.useContext(ye)}function ot({children:o}){const[t,r]=c.useReducer(rt,{duration:1e4,started:!1});return e.jsx(ve.Provider,{value:t,children:e.jsx(ye.Provider,{value:r,children:o})})}const xe=300,at=500,it=c.forwardRef(({tileSize:o,rubickFaces:t,width:r,height:n,animationType:s,onStart:x,onFinish:p},y)=>{const j=st(),{duration:l}=Ce(),u=c.useRef(null),d=c.useRef(new U),C=c.useRef([]),g=c.useRef(0),f=c.useRef([]),E=t.length*9*3,h=c.useMemo(()=>({x:r/2,y:n/2}),[r,n]),v=Se();pe({ref:v,from:{rotationStep:0},to:{rotationStep:1},config:{duration:xe},delay:at,reset:!0,onStart:()=>{j({type:"start"})},onRest:()=>{if(f.current=f.current.map(M=>({...M,currentMove:M.currentMove+1})),g.current=0,G()){v.stop(),j({type:"finish"}),p(u.current);return}v.start({from:{rotationStep:0},to:{rotationStep:1}})},onChange:({value:{rotationStep:M}})=>{t.length>0&&B((M-g.current)*(Math.PI/2)),g.current=M}}),c.useImperativeHandle(y,()=>({reset(){u!=null&&u.current!=null&&(t.length<=0||G()&&(R(),g.current=0,v.start({from:{rotationStep:0},to:{rotationStep:1}}),u.current.instanceMatrix.needsUpdate=!0))}})),c.useEffect(()=>{u!=null&&u.current!=null&&(t.length<=0||(R(),g.current=0,v.start(),u.current.instanceMatrix.needsUpdate=!0))},[t.length,s]);function R(){C.current=[],f.current=[],d.current.set(0,0,0);let M=0;t.forEach((N,b)=>{for(let F=-1;F<=1;F++){N.forEach(({x:H,y:V,color:Z})=>{var ce;const J=new oe;J.position.set(H/o+d.current.x,-(V/o)+d.current.y,F+d.current.z),J.rotation.set(...je(Z)),J.updateMatrix(),(ce=u.current)==null||ce.setMatrixAt(M,J.matrix),M++});const{x:A,y:z}=N[0];C.current.push(new U(A/o,z/o,F))}const{x:w,y:m}=N[0],k=S(b,D(w,m,b),3);f.current.push(k)}),x(u.current)}function i(M,N,b,w){switch(M){case"wave":default:return I(N,b,!1);case"inverted-wave":return I(N,b,!0);case"one-by-one":return w/t.length*a();case"random":return Math.floor(Math.random()*a())}}function a(){return Math.ceil(l/xe)}function I(M,N,b){const w=Math.abs(h.x-M),m=Math.abs(h.y-N),k=Math.sqrt(w*w+m*m),F=Math.sqrt(h.x*h.x+h.y*h.y),A=(F-k)/F;return b?a()*A:a()*(1-A)}function D(M,N,b){let w=[];const m=Math.ceil(i(s,M,N,b)/2);for(let k=0;k<m;k++){const F=ee(["X","Y","Z"]),A=ee([0,1,2]),z=ee([-1,1]);w.push({axis:F,face:A,direction:z})}for(let k=m-1;k>=0;k--){const{axis:F,face:A,direction:z}=w[k];w.push({axis:F,face:A,direction:-z})}return{movesLength:m*2,currentMove:0,moves:w}}function S(M,N,b){const{movesLength:w,moves:m}=N;if(b>w)return{movesLength:w,moves:m,currentMove:0};for(let k=0;k<b;k++)P(m[k].axis,M,m[k].face,m[k].direction*Math.PI/2);return{movesLength:w,moves:m,currentMove:b}}function B(M){u.current&&(t.forEach((N,b)=>{const{moves:w,currentMove:m,movesLength:k}=f.current[b];if(m>=k)return;const{axis:F,face:A,direction:z}=w[m];P(F,b,A,z*M)}),u.current.instanceMatrix.needsUpdate=!0)}function P(M,N,b,w){const m=C.current[N*3+b];O(M,N,b,m).forEach(({id:F,object:A})=>{var Z;const[z,H]=L(M,b,m,d.current),V=new $().makeRotationFromEuler(W(M,w));A.applyMatrix4(z.multiply(V).multiply(H)),(Z=u.current)==null||Z.setMatrixAt(F,A.matrix)})}function L(M,N,b,w){switch(M){case"X":default:return[new $().setPosition(new U(0,-(w.y+1)-b.y,w.z+b.z+(1-N))),new $().setPosition(new U(0,-(w.y-1)+b.y,-w.z-b.z-(1-N)))];case"Y":return[new $().setPosition(new U(w.x+1+b.x,0,w.z+b.z+(1-N))),new $().setPosition(new U(-(w.x+1)-b.x,0,-w.z-b.z-(1-N)))];case"Z":return[new $().setPosition(new U(w.x+1+b.x,-(w.y+1)-b.y,0)),new $().setPosition(new U(-(w.x+1)-b.x,-(w.y-1)+b.y,0))]}}function O(M,N,b,w){var F;let m=[];const k=N*3*9;for(let A=k;A<27+k;A++){const z=new oe,H=new $;(F=u.current)==null||F.getMatrixAt(A,H),H.decompose(z.position,z.quaternion,z.scale),T(M,b,w,z.position)&&m.push({id:A,object:z})}return m}function T(M,N,b,w){switch(M){case"X":return Math.round(w.x)-d.current.x-b.x===N;case"Y":return Math.round(-w.y)-d.current.y-b.y===N;case"Z":return Math.round(w.z)-d.current.z===N-1;default:return!1}}function W(M,N){switch(M){case"X":default:return new ne(N,0,0);case"Y":return new ne(0,N,0);case"Z":return new ne(0,0,N)}}function G(){return f.current.filter(N=>N.currentMove>=N.movesLength).length===f.current.length}return e.jsx("instancedMesh",{receiveShadow:!0,ref:u,args:[tt,we,E]})});function ct({tileSize:o,rubickFaces:t,onStart:r}){const n=c.useRef(null),s=t.length*9;function x(){let p=0;t.forEach(y=>{y.forEach(({x:j,y:l,color:u})=>{var C;const d=new oe;d.position.set(j/o,-(l/o),0),d.rotation.set(...je(u)),d.updateMatrix(),(C=n.current)==null||C.setMatrixAt(p,d.matrix),p++})})}return c.useEffect(()=>{n!=null&&n.current!=null&&(t.length<=0||(x(),r(n.current),n.current.instanceMatrix.needsUpdate=!0))},[t]),e.jsx("instancedMesh",{ref:n,args:[nt,we,s]})}function lt({label:o,onClick:t}){const[r,n]=c.useState(0),[s,x]=c.useState(!1),p=c.useRef(void 0),y=c.useRef(void 0),{started:j,duration:l}=Ce();function u(g){if(y.current!=null){const f=g-y.current;n(E=>E+f)}y.current=g,p.current=requestAnimationFrame(u)}c.useEffect(()=>{j?d():(p.current&&cancelAnimationFrame(p.current),x(!1),n(0),y.current=void 0)},[j]),c.useEffect(()=>()=>{p.current&&cancelAnimationFrame(p.current)},[]);function d(){s===!1&&(x(!0),t(),requestAnimationFrame(u))}const C=r/l*100;return e.jsxs("button",{className:"btn btn-secondary btn-xs flex flex-row justify-start px-0 w-full",onClick:d,children:[e.jsx("div",{className:"bg-primary w-full h-full flex items-center justify-center",style:{width:`${C}%`}}),e.jsx("div",{className:"absolute object-center",style:{left:"50%",transform:"translate(-50% , 0%)"},children:r===0?o:`${Math.trunc(C)}%`})]})}function ut({canvasRef:o,videoRef:t}){const r=c.useRef([]),n=c.useRef(),s=c.useRef(),[x,p]=c.useState(!1);function y(){if(o.current){r.current=[];try{s.current=o.current.captureStream(),n.current=new MediaRecorder(s.current,{mimeType:"video/webm"}),n.current.onstop=j,n.current.ondataavailable=u,n.current.start(100),p(!0)}catch(C){console.error("Unable to create MediaRecorder with options Object: ",C)}}}function j(){const C=new Blob(r.current,{type:"video/webm"});t&&t.current&&(t.current.src=window.URL.createObjectURL(C))}function l(){n.current&&(n.current.stop(),p(!1),t&&t.current&&(t.current.controls=!0))}function u(C){C.data&&C.data.size>0&&r.current.push(C.data)}function d(){const C=new Blob(r.current,{type:"video/webm"}),g=window.URL.createObjectURL(C),f=document.createElement("a");f.href=g,f.download="rubiks-images.webm",document.body.appendChild(f),f.click(),setTimeout(()=>{document.body.removeChild(f),window.URL.revokeObjectURL(g)},100)}return{stopRecord:l,startRecord:y,download:d,isRecording:x}}const dt=()=>e.jsx("svg",{className:"fill-current",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M3 22v-20l18 10-18 10z"})}),ht=()=>e.jsx("svg",{className:"fill-current",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M2 2h20v20h-20z"})}),ft=()=>e.jsx("svg",{className:"fill-current",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M14 3h2.997v5h-2.997v-5zm9 1v20h-22v-24h17.997l4.003 4zm-17 5h12v-7h-12v7zm14 4h-16v9h16v-9z"})});function mt({canvasRef:o}){const{stopRecord:t,startRecord:r,download:n,isRecording:s}=ut({canvasRef:o});return e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("button",{className:`btn-sm btn btn-outline join-item ${s?"btn-accent":"btn-primary"} `,onClick:s?t:r,children:[s?"Stop":"Record",s?e.jsx(ht,{}):e.jsx(dt,{})]}),e.jsxs("button",{className:"btn-sm btn btn-outline join-item btn-secondary",disabled:s,onClick:n,children:["Save",e.jsx(ft,{})]})]})}function xt({width:o,height:t,tileSize:r,rubickFaces:n}){const s=c.useRef(null),x=c.useRef(null),p=c.useRef(null),[y,j]=c.useState(!1),[l,u]=c.useState(!1),[d,C]=c.useState("wave"),{toggleFullscreen:g}=ge({target:x}),f=ke(()=>{g()}),[E,h]=c.useState(500),[{position:v,rotation:R},i]=pe(()=>({from:{position:[0,0,0],rotation:[0,0,0]},config:{mass:5,tension:500,friction:150,precision:1e-4}})),a=c.useRef(null);c.useEffect(()=>{l?i.start({to:{position:[o/r,0,0],rotation:[0,Math.PI,0]}}):i.start({to:{position:[0,0,0],rotation:[0,0,0]}})},[l]);async function I(B){if(s.current){i.start({to:{position:[0,0,0],rotation:[0,-Math.PI/6,0]}}),s.current.maxDistance=500,await s.current.setLookAt(0,0,1,0,0,0,!1),await s.current.fitToBox(B,!0,{paddingLeft:10,paddingRight:10,paddingBottom:10,paddingTop:10});let P=new U;s.current.getPosition(P,!1),h(P.z+5)}}function D(){i.start({to:{position:[0,0,0],rotation:[0,0,0]}})}function S(){a&&a.current&&a.current.reset()}return e.jsx(ot,{children:e.jsxs(e.Fragment,{children:[e.jsx(Y,{label:"Hide other faces (improve performances)",value:y,toggle:()=>j(!y)}),e.jsx(Y,{label:"Invert",value:l,toggle:()=>u(!l)}),!y&&e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(lt,{label:"Reset Animation",onClick:S}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-2 items-center justify-between",children:[e.jsx(Qe,{label:"Animation type",value:d,onChange:B=>C(B),options:[{value:"wave",label:"Wave"},{value:"inverted-wave",label:"Inverted Wave"},{value:"one-by-one",label:"One by one"},{value:"random",label:"Random"}]}),e.jsx(mt,{canvasRef:p})]})]}),e.jsx("div",{className:"flex flex-col gap-5 w-full h-screen",ref:x,onDoubleClick:g,...f,children:e.jsx(Fe,{camera:{position:[0,0,10],fov:35,far:1e3},dpr:window.devicePixelRatio,ref:p,children:e.jsxs(c.Suspense,{fallback:e.jsx("span",{className:"loading loading-dots loading-lg"}),children:[e.jsx("color",{attach:"background",args:["#c0d6e9"]}),e.jsx(e.Fragment,{}),e.jsx("ambientLight",{color:0,intensity:.2}),e.jsx("directionalLight",{color:16777215,position:[-5,1,0],intensity:1.5}),e.jsx("directionalLight",{color:16777215,position:[-5,1,-5],intensity:1}),e.jsx("directionalLight",{color:16777215,position:[5,0,5],intensity:3}),e.jsx(Ae,{scale:[o*1.5,t/r*3,100],position:[0,-(t/r)-5,-o/r],floor:10,segments:20,receiveShadow:!0,children:e.jsx("meshStandardMaterial",{color:"#FF0000",metalness:1,emissive:"#45A5FF",flatShading:!0})}),e.jsx(ze.group,{rotation:R,position:v,children:y?e.jsx(ct,{tileSize:r,rubickFaces:n,onStart:I}):e.jsx(it,{tileSize:r,rubickFaces:n,width:o,height:t,animationType:d,onStart:I,onFinish:D,ref:a})}),e.jsx(Pe,{alignment:"bottom-right",margin:[50,50],children:e.jsx(Le,{labelColor:"white",axisHeadScale:1})}),e.jsx(Te,{minPolarAngle:0,maxPolarAngle:Math.PI/1.9,minAzimuthAngle:-.55,maxAzimuthAngle:.55,makeDefault:!0,maxDistance:E,ref:s})]})})})]})})}const se=32,Q=5e3;function gt(){const[o,t]=c.useState(""),[r,n]=c.useState(),[s,x]=c.useState(!0),[p,y]=c.useState(!0),[j,l]=c.useState({tileSize:se,width:0,height:0}),u=K.isMobile?Q/2:Q,d=c.useRef(null),{computePossibleSize:C,possibleWidth:g,possibleHeight:f,ratio:E,setRatio:h,maxRatio:v,bestProportion:R,setBestProportion:i,setTileSize:a}=He({initialTileSize:se}),{optimizedGenerateImage:I,setOption:D,noise:S,tileSize:B,rubickFaces:P}=Ge({initialTileSize:se}),{contrastedImage:L,computeImage:O}=$e(),T=c.useRef(null);c.useEffect(()=>{r&&T.current&&O(r,T.current)},[r]),c.useEffect(()=>{r&&T.current&&C(r.width,r.height,K.isMobile)},[B,R,E]);function W(m){n(m),console.log("newImage ",m.width,": ",m.height);const[k,F]=C(m.width,m.height,K.isMobile);N(k,F,K.isMobile),i(!0),h(1),m.width===0?t("Error! The image has 0 pixels as width"):m.height===0?t("Error! The image has 0 pixels as height"):m.width<B||m.height<B?t("Error! The image has a dimension below the tileSize"):t("")}function G(){if(l({tileSize:B,width:g,height:f}),!r){t("Error! Please upload an image");return}if(!p){I(r,g,f);return}if(!L){t("Contrasted image is not fully generated");return}I(L,g,f),d.current&&d.current.scrollIntoView({behavior:"smooth"})}function M(){return p?!!L:!!r}function N(m,k,F){const A=F?Q/2:Q,z=Math.sqrt(m*k/A),H=Math.ceil(z),V=H<=8?8:H+8-H%8;a(V),D("tileSize",V)}function b(){if(!r)return e.jsx(e.Fragment,{});const m=g,k=f;return e.jsxs("div",{className:"flex flex-row gap-3 w-full",children:[e.jsxs("div",{className:"tooltip flex flex-row items-center gap-1","data-tip":`${m} pixels`,children:[e.jsx("span",{className:"font-semibold",children:"Width:"}),e.jsxs("span",{className:"italic",children:[m/B," cubes"]}),e.jsx("img",{src:ae,width:"16px",alt:"rubick's cubes"})]}),e.jsxs("div",{className:"tooltip flex flex-row items-center gap-1","data-tip":`${k} pixels`,children:[e.jsx("span",{className:"font-semibold",children:"Height:"}),e.jsxs("span",{className:"italic",children:[k/B," cubes"]}),e.jsx("img",{src:ae,width:"16px",alt:"rubick's cubes"})]})]})}function w(){const m=e.jsx("button",{className:"btn btn-accent w-full",disabled:!M(),onClick:G,children:"Generate"});return M()?m:e.jsx("div",{className:"tooltip tooltip-error","data-tip":"Upload an image first !",children:m})}return e.jsx("div",{className:"container mx-auto md:px-0 px-5",children:e.jsxs("div",{className:"flex flex-col gap-4 h-screen",children:[e.jsx(Ve,{}),e.jsxs("div",{className:"flex flex-col xl:flex-row gap-6 basis-full",children:[e.jsx("div",{className:"xl:w-3/12",children:e.jsx(fe,{title:"Settings",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs(me,{title:"Upload your image",children:[o!==""&&e.jsx(Ze,{errorMessage:o}),e.jsx(Ye,{onChange:W,value:r}),e.jsx("canvas",{ref:T,style:{display:"none"}})]}),e.jsxs(_e,{children:[e.jsxs("div",{className:"bg-base-100 p-2 border border-white",children:[e.jsx("h3",{className:"italic text-lg",children:"Rendering"}),e.jsxs("div",{children:[e.jsx(re,{label:"Noise",value:S,max:50,onChange:m=>D("noise",m)}),e.jsx(Y,{label:"Add constract",value:p,toggle:()=>{y(!p)}})]})]}),e.jsxs("div",{className:"bg-base-100 p-2 border border-white",children:[e.jsx("h3",{className:"italic text-lg",children:"Size"}),e.jsxs("div",{children:[e.jsx(re,{label:"TileSize",value:B,max:128,min:8,step:8,onChange:m=>{D("tileSize",m),a(m),m<((r==null?void 0:r.width)||0)&&m<((r==null?void 0:r.height)||0)&&t("")}}),e.jsxs("div",{className:"flex flex-row gap-2 items-center",children:[e.jsx(Y,{label:"Best proportion",value:R,toggle:()=>{i(!R)}}),e.jsx("div",{className:"w-full",children:e.jsx(re,{label:"Ratio",value:E,max:v,min:3,step:3,disabled:R,onChange:m=>h(m)})})]})]})]}),g/B*(f/B)>u?e.jsxs("div",{role:"alert",className:"alert alert-warning",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"stroke-current shrink-0 h-6 w-6",fill:"none",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsx("span",{children:"Warning: The number of cubes can be too much in 3D"})]}):e.jsx(e.Fragment,{}),b()]}),w()]})})}),e.jsx("div",{className:"xl:w-9/12 w-full h-full",children:e.jsx(fe,{title:"Result",children:e.jsx(me,{title:e.jsxs("div",{role:"tablist",className:"tabs tabs-boxed font-bold bg-base-300",children:[e.jsx("a",{role:"tab",className:`hover:text-grey w-1/2 tab ${s?"tab-active bg-primary text-black hover:text-black":""}`,onClick:()=>x(!0),children:"3D view"}),e.jsx("a",{role:"tab",className:`w-1/2 tab ${s?"":"tab-active bg-primary text-black hover:text-black"}`,onClick:()=>x(!1),children:"2D view"})]}),children:e.jsx("div",{className:"w-full h-full",ref:d,children:s?e.jsxs(e.Fragment,{children:[e.jsx(xt,{width:j.width,height:j.height,tileSize:j.tileSize,rubickFaces:P}),e.jsx("p",{className:"text-xs italic",children:"Double click/tap on the canvas to go full screen"})]}):e.jsx(Ke,{width:g,height:f,tileSize:B,rubickFaces:P})})})})})]}),e.jsx(Xe,{})]})})}Ie.createRoot(document.getElementById("root")).render(e.jsx(De.StrictMode,{children:e.jsx(gt,{})}));
